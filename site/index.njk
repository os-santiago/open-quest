---
layout: base.njk
title: Panel Open Quest
tags:
  - dashboard
---
<section class="card">
  <header>
    <div class="badge">Temporada {{ leaderboard.temporada.id }}</div>
    <h2>{{ leaderboard.temporada.titulo }}</h2>
    {% if leaderboard.temporada.descripcion %}
      <p>{{ leaderboard.temporada.descripcion }}</p>
    {% endif %}
    {% if leaderboard.generated_at %}
      <small>Última generación del leaderboard: {{ leaderboard.generated_at }}</small>
    {% elseif leaderboard.missing %}
      <small>No se encontró <code>docs/data/leaderboard.json</code>. Se mostrará un estado base.</small>
    {% elseif leaderboard.parseError %}
      <small>Error al procesar el leaderboard: {{ leaderboard.parseError }}</small>
    {% endif %}
  </header>

  <div class="summary-grid">
    <div class="summary-card">
      <h3>Participantes</h3>
      <p>{{ leaderboard.resumen_global.total_participantes | default(leaderboard.jugadores.length) }}</p>
    </div>
    <div class="summary-card">
      <h3>XP total</h3>
      <p>{{ missionSummary.xpTotalAcumulada }}</p>
    </div>
    <div class="summary-card">
      <h3>Misiones completadas</h3>
      <p>{{ leaderboard.resumen_global.misiones_completadas | default(0) }}</p>
    </div>
    <div class="summary-card">
      <h3>XP promedio</h3>
      <p>{{ leaderboard.resumen_global.xp_promedio | default(0) }}</p>
    </div>
  </div>

  {% if leaderboard.resumen_global.clases_activas.length %}
    <div class="badge">Clases activas</div>
    <ul class="list-inline">
      {% for clase in leaderboard.resumen_global.clases_activas %}
        <li>{{ clase }}</li>
      {% endfor %}
    </ul>
  {% endif %}
</section>

<section class="card">
  <h2>Actividad reciente</h2>
  {% if missionSummary.generatedAt %}
    <p><strong>mission-merge</strong> generó los artefactos el <time datetime="{{ missionSummary.generatedAt }}">{{ missionSummary.generatedAt }}</time>.</p>
  {% elseif missionSummary.missing %}
    <p class="empty-state">Todavía no se ha ejecutado <code>mission-merge</code> en este repositorio.</p>
  {% else %}
    <p>Resumen no disponible.</p>
  {% endif %}

  <dl>
    <div>
      <dt>Participantes procesados</dt>
      <dd>{{ missionSummary.participantesProcesados }}</dd>
    </div>
    <div>
      <dt>XP total acumulada</dt>
      <dd>{{ missionSummary.xpTotalAcumulada }}</dd>
    </div>
    <div>
      <dt>Misiones registradas</dt>
      <dd>{{ missionSummary.misionesRegistradas }}</dd>
    </div>
  </dl>
</section>

<section class="card">
  <h2>Leaderboard del gremio</h2>
  {% if leaderboard.jugadores.length %}
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th scope="col">Pos</th>
            <th scope="col">Usuario</th>
            <th scope="col">Clase</th>
            <th scope="col">Nivel</th>
            <th scope="col">Rango</th>
            <th scope="col">XP</th>
            <th scope="col">Misiones</th>
            <th scope="col">Última misión</th>
          </tr>
        </thead>
        <tbody>
          {% for jugador in leaderboard.jugadores %}
            <tr>
              <td>{{ jugador.posicion }}</td>
              <td>
                <strong>{{ jugador.usuario }}</strong>
                {% if jugador.nombre %}<br><small>{{ jugador.nombre }}</small>{% endif %}
              </td>
              <td>{{ jugador.clase | default("-") }}</td>
              <td>{{ jugador.nivel }}</td>
              <td>{{ jugador.rango | default("-") }}</td>
              <td>{{ jugador.xp }}</td>
              <td>{{ jugador.misiones }}</td>
              <td>
                {% if jugador.ultima_mision %}
                  <time datetime="{{ jugador.ultima_mision }}">{{ jugador.ultima_mision }}</time>
                {% else %}
                  —
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="empty-state">
      <p>Cuando se registren misiones y participantes, aparecerán aquí sus posiciones.</p>
    </div>
  {% endif %}
</section>
